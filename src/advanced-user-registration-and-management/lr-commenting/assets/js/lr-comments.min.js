jQuery(document).ready(function() {
    jQuery(".lr-reply-btn").find("a").prop("onclick", null).off("click");
});
jQuery(function(e) {
    function t() {
        var t = sessionStorage.getItem("share_twitter_token");
        null != t && e.ajax({
            type: "POST",
            url: commentvar.ajaxurl,
            data: {
                action: "loginradius_get_mentions",
                share_twitter_token: t
            },
            success: function(t) {
                t = e.parseJSON(t), e(".lr-mention-menu-content").html("");
                for (var r = 0; r < t.Twitter.length; r++) {
                    var o = t.Twitter[r].ProfileUrl;
                    o = o.split("twitter.com/")[1];
                    var n = e("<div></div>").addClass("lr-mention-item lr-mention-item-twitter").attr("data-mention", "@" + o).append(e("<img />").attr("src", t.Twitter[r].ImageUrl).addClass("lr-mention-item-avatar"));
                    n.append(e("<h4></h4>").addClass("lr-mention-item-display-name").text(t.Twitter[r].Name)), n.append(e("<span></span>").addClass("lr-img-icon-twitter")), e(".lr-mention-menu-content").append(n), e(".lr-editor-btn.mention").show()
                }
                e(".lr-mention-item").click(function() {
                    var t = this.attributes[1].value;
                    e(".jqte_editor").append(" " + t + " "), this.remove(), 0 == e(".lr-mention-item").length && e(".lr-mention-menu").remove()
                })
            }
        })
    }

    function r(r) {
        var o = new Array;
        "true" === commentvar.image_upload_enable && e("#images img").each(function() {
            o.push(e(this).attr("src"))
        });
        var n = sessionStorage.getItem("LRTokenKey"),
            i = sessionStorage.getItem("share_facebook_token"),
            s = sessionStorage.getItem("share_twitter_token"),
            a = sessionStorage.getItem("share_linkedin_token"),
            m = e.trim(e("#comment").val()),
            l = e("#comment_post_ID").val(),
            c = e("#comment_parent").val(),
            g = e("#author").val(),
            d = e("#email").val(),
            h = e("#url").val(),
            u = sessionStorage.getItem("share_selected");
        if (e(".lr-comment-login-container").hide(), e(".lr-comment-overlay").hide(), "true" != u) e(".lr_comment_loader").show(), e.ajax({
            type: "POST",
            url: commentvar.ajaxurl,
            data: {
                token: "false" == commentvar.is_user_logged_in ? n : null,
                action: "loginradius_post_comment",
                share_facebook_token: i,
                share_twitter_token: s,
                share_linkedin_token: a,
                author: g,
                email: d,
                images: o,
                url: h,
                comment: m,
                comment_parent: c,
                comment_post_ID: l
            },
            success: function(t, r, o) {
                var n;
                try {
                    t = e.parseJSON(t), n = t.Error
                } catch (i) {
                    n = t
                }
                "true" == commentvar.debugging && console.log(t), "" != n ? (e(".lr_comment_loader").hide(), e("#lr-comment-error-msg div").html(n), e("#lr-comment-error-msg").show()) : (e(".jqte_editor").empty(), document.location.reload())
            }
        });
        else {
            var n = sessionStorage.getItem("LRTokenKey"),
                _ = sessionStorage.getItem("share_provider"),
                v = new Date;
            switch (v = v.getTime(), _) {
                case "facebook":
                    sessionStorage.setItem("share_facebook_token", n), sessionStorage.setItem("share_facebook_start", v);
                    break;
                case "twitter":
                    sessionStorage.setItem("share_twitter_token", n), sessionStorage.setItem("share_twitter_start", v), t();
                    break;
                case "linkedin":
                    sessionStorage.setItem("share_linkedin_token", n), sessionStorage.setItem("share_linkedin_start", v)
            }
            sessionStorage.removeItem("LRTokenKey"), sessionStorage.removeItem("share_selected"), sessionStorage.removeItem("share_provider")
        }
    }

    function o(t) {
        var r = e("#lr-" + t.name + "-share-switch"),
            o = e("#lr-" + t.name + "-share-trigger");
        r.is(":checked") ? (sessionStorage.setItem("share_selected", "true"), sessionStorage.setItem("share_provider", t.name), o.trigger("click")) : (sessionStorage.removeItem("share_" + t.name + "_token"), sessionStorage.removeItem("share_" + t.name + "_start"), "twitter" == t.name && e(".lr-mention-button").hide())
    }

    function n(e) {
        var t = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return t.test(e)
    }

    function i(e) {
        var t = e / 1e3 / 60 << 0;
        return 15 > t ? !0 : !1
    }
    if (e(document).on("change", ".jqte_editor", function(t) {
            t.preventDefault();
            var r = sessionStorage.getItem("share_twitter_token"),
                o = e(".jqte_editor").text();
            e(".lr-comment-editor-length").html(o.length), 140 <= o.length && null !== r ? e(".lr-comment-editor-length").addClass("error") : e(".lr-comment-editor-length").removeClass("error")
        }), t(), e(document).on("change", ".lr-share-switch", function() {
            LoginRadiusSDK.onlogin = r, o(this)
        }), e(".lr-editor-btn.format").click(function() {
            e(".lr-editor-format-container").toggle(), e(".lr-share-container").hide()
        }), e(".lr-editor-btn.share").click(function() {
            e("#lr-comment-error-msg").hide(), e(".lr-editor-format-container").hide(), e(".lr-share-container").toggle()
        }), e(".lr-editor-btn.mention").click(function() {
            e(".lr-mention-menu").toggle()
        }), e(".lr_logininterface_container").click(function() {
            sessionStorage.removeItem("LRTokenKey"), sessionStorage.removeItem("share_selected"), sessionStorage.removeItem("share_provider")
        }), e(".lr-post-button.login-btn").click(function() {
            LoginRadiusSDK.onlogin = r, sessionStorage.removeItem("LRTokenKey"), e(".lr-editor-format-container").hide(), e(".lr-share-container").hide(), "" != e.trim(e("#comment").val()) ? (e("#lr-comment-error-msg div").html(""), e("#lr-comment-error-msg").hide(), e(".lr-comment-login-container,.lr-comment-overlay").show()) : (e("#lr-comment-error-msg div").html(commentvar.empty_msg), e("#lr-comment-error-msg").show())
        }), e(".lr-post-button.post-btn").click(function() {
            LoginRadiusSDK.onlogin = r, sessionStorage.removeItem("share_selected"), sessionStorage.removeItem("share_provider"), "" != e.trim(e("#comment").val()) ? (e("#lr-comment-error-msg").hide(), r()) : (e("#lr-comment-error-msg div").html(commentvar.empty_msg), e("#lr-comment-error-msg").show())
        }), e(".lr-close-popup,.lr-comment-overlay").click(function() {
            e(".lr-comment-login-container,.lr-comment-overlay").hide()
        }), e(".jqte_editor").click(function() {
            e("html").trigger()
        }), e("html").click(function() {
            e(".lr-share-container,.lr-editor-format-container,.lr-mention-menu,#lr-comment-error-msg").hide()
        }), e(".lr-comment-editor-toolbar").click(function(e) {
            e.stopPropagation()
        }), "true" === commentvar.editor_enable && (e("#comment").jqte({
            format: !1,
            sub: !1,
            remove: !1,
            sup: !1,
            center: !1,
            color: !1,
            fsize: !1,
            indent: !1,
            outdent: !1,
            left: !1,
            right: !1,
            link: !1,
            strike: !1,
            unlink: !1,
            source: !1,
            rule: !1
        }), "true" === commentvar.image_upload_enable)) {
        e(".lr-editor-btn.img").click(function() {
            e("[type=file]:enabled").click()
        });
        var s;
        e(document).on("drop", ".jqte [contenteditable]", function() {
            s && (e(s).remove(), s = void 0), setTimeout(function() {
                document.execCommand("unselect")
            }, 100)
        }), e(document).on("dragstart", "#images img", function() {
            s = this
        }).on("dragend", "#images img", function() {}), e(document).on("change", "[type=file]", function(t) {
            var r = e(this);
            r.parent().append(r.clone()), r.hide().prop("disabled", !0), e.each(e(this).prop("files"), function(t, o) {
                var n = new FileReader;
                n.onload = function(t) {
                    e("<img/>", {
                        src: t.target.result
                    }).css({
                        maxWidth: 250,
                        padding: "10px"
                    }).appendTo(r.parent())
                }, n.readAsDataURL(o)
            })
        })
    }
    e(".post_comment_form").click(function() {
        LoginRadiusSDK.onlogin = r, sessionStorage.removeItem("share_selected"), sessionStorage.removeItem("share_provider");
        var t = e.trim(e("#author").val()),
            o = e.trim(e("#email").val());
        "" == t ? e(".comment-form-author label,.required.name").show() : e(".required.name").hide(), "" == o ? e(".comment-form-email label,.required.email").show() : e(".required.email").hide(), n(o) ? e(".required.email").hide() : e(".required.email").show(), "" != t && "" != o && n(o) && r()
    }), e(window).load(function() {
        var t = sessionStorage.getItem("share_facebook_token"),
            r = sessionStorage.getItem("share_twitter_token"),
            o = sessionStorage.getItem("share_linkedin_token"),
            n = (sessionStorage.getItem("share_twitter_start"), sessionStorage.getItem("share_linkedin_start"), new Date);
        if (n = n.getTime(), null !== t) {
            var s = i(n - sessionStorage.getItem("share_facebook_start"));
            1 == s ? e("#lr-facebook-share-switch").prop("checked", !0) : (sessionStorage.removeItem("share_facebook_token"), sessionStorage.removeItem("share_facebook_start"))
        }
        if (null !== r) {
            var s = i(n - sessionStorage.getItem("share_twitter_start"));
            1 == s ? (e(".lr-mention-button").show(), e("#lr-twitter-share-switch").prop("checked", !0)) : (sessionStorage.removeItem("share_twitter_token"), sessionStorage.removeItem("share_twitter_start"))
        }
        null !== o && e("#lr-linkedin-share-switch").prop("checked", !0)
    })
});